# ABOUTME: Example Fastly Compute service configuration
# ABOUTME: Copy to fastly.toml and fill in your credentials

manifest_version = 3
name = "fastly-blossom"
description = "Blossom media server for Nostr"
authors = ["Divine <hello@divine.video>"]
language = "rust"

[local_server]

  [local_server.backends]

    [local_server.backends.gcs_storage]
    url = "https://storage.googleapis.com"

  [local_server.kv_stores]

    [local_server.kv_stores.blossom_metadata]
    file = "kv-store-data.json"

  [local_server.config_stores]

    [local_server.config_stores.blossom_config]

      [local_server.config_stores.blossom_config.contents]
      gcs_bucket = "YOUR_BUCKET_NAME"
      gcs_project_id = "YOUR_GCP_PROJECT_ID"

  [local_server.secret_stores]

    [local_server.secret_stores.blossom_secrets]

      [local_server.secret_stores.blossom_secrets.contents]

        [local_server.secret_stores.blossom_secrets.contents.gcs_access_key]
        plaintext = "YOUR_GCS_ACCESS_KEY"

        [local_server.secret_stores.blossom_secrets.contents.gcs_secret_key]
        plaintext = "YOUR_GCS_SECRET_KEY"

[setup]

  [setup.backends]

    [setup.backends.gcs_storage]
    description = "Google Cloud Storage S3-compatible backend"
    address = "storage.googleapis.com"
    port = 443

  [setup.kv_stores]

    [setup.kv_stores.blossom_metadata]
    description = "Blob metadata storage"

  [setup.config_stores]

    [setup.config_stores.blossom_config]
    description = "Service configuration"
    items = [
      { key = "gcs_bucket", description = "GCS bucket name" },
      { key = "gcs_project_id", description = "GCP project ID" },
    ]

  [setup.secret_stores]

    [setup.secret_stores.blossom_secrets]
    description = "Sensitive credentials"
    entries = [
      { key = "gcs_access_key", description = "GCS HMAC access key" },
      { key = "gcs_secret_key", description = "GCS HMAC secret key" },
    ]
