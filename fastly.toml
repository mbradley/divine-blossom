# ABOUTME: Fastly Compute service configuration
# ABOUTME: Defines backends (B2), KV stores, and config stores

manifest_version = 3
name = "fastly-blossom"
description = "Blossom media server for Nostr"
authors = ["Divine <hello@divine.video>"]
language = "rust"

[local_server]

  [local_server.backends]

    [local_server.backends.b2_storage]
    url = "https://s3.us-west-004.backblazeb2.com"

  [local_server.kv_stores]

    [local_server.kv_stores.blossom_metadata]
    file = "kv-store-data.json"

  [local_server.config_stores]

    [local_server.config_stores.blossom_config]

      [local_server.config_stores.blossom_config.contents]
      b2_bucket = "your-bucket-name"
      b2_region = "us-west-004"

  [local_server.secret_stores]

    [local_server.secret_stores.blossom_secrets]

      [local_server.secret_stores.blossom_secrets.contents]

        [local_server.secret_stores.blossom_secrets.contents.b2_key_id]
        plaintext = "your-key-id"

        [local_server.secret_stores.blossom_secrets.contents.b2_app_key]
        plaintext = "your-app-key"

[setup]

  [setup.backends]

    [setup.backends.b2_storage]
    description = "Backblaze B2 S3-compatible storage"
    address = "s3.us-west-004.backblazeb2.com"
    port = 443

  [setup.kv_stores]

    [setup.kv_stores.blossom_metadata]
    description = "Blob metadata storage"

  [setup.config_stores]

    [setup.config_stores.blossom_config]
    description = "Service configuration"
    items = [
      { key = "b2_bucket", description = "B2 bucket name" },
      { key = "b2_region", description = "B2 region (e.g., us-west-004)" },
    ]

  [setup.secret_stores]

    [setup.secret_stores.blossom_secrets]
    description = "Sensitive credentials"
    entries = [
      { key = "b2_key_id", description = "Backblaze B2 key ID" },
      { key = "b2_app_key", description = "Backblaze B2 application key" },
    ]
